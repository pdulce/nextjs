<html>
  <head>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"
      type="text/javascript"
    ></script>

    <script
      src="https://rawgit.com/chen0040/js-regression/master/build/jsregression.min.js"
      type="application/javascript"
    ></script>
    <!--<script src="./src/jsregression.js" type="application/javascript"></script>-->
  </head>
  <body>
    <h2>
      Linear Regression para Modelo Óptimo de Cartera de Peticiones de AT-DG
    </h2>

    <h5>
      <p>
        ASUMIMOS que el periodo de desarrollo no debería superar un mes, con un
        máximo total de uts estimadas de la cartera de unas 1.500 uts. Deseamos
        disponer de un modelo que maximime el número de peticiones de una
        cartera de peticiones de una entrega/versión planificada, de forma que
        se minimice el riesgo de no lograr la consecución de los trabajos
        derivados de la misma en tiempo y/o calidad. Esos trabajos constituyen
        el diseño, implementación y pruebas (automatizadas o no), que garanticen
        un mínimo número de iteraciones en las validaciones que de esa versión
        se realicen posteriormente en el área de AT. Tomaremos en consideraicón
        el tipo de proyecto, nº de peticiones de cada tipología de
        peticiones,... Modelo propuesto: x1: tipo de proyecto (0:con
        mantenimiento en Producción,1:Desarrollo puro) x2/PE: núm. peticiones de
        Pequeños Evolutivos x3/ME_B: núm. peticiones de Mejoras Desarrollo
        [80-250] uts x4/ME_M: núm. peticiones de Mejoras Desarrollo [250-500]
        uts x5/ME_A: núm. peticiones de Mejoras Desarrollo [501-1000] uts
        x6/ND_M: núm. peticiones de Nuevos Desarrollos [500-1000] uts x7/ND_A:
        núm. peticiones de Nuevos Desarrollos [1001-4000] uts y: % de éxito en
        lograr cubrir la entrega en forma [0..1] con esa cartera. 
        
        Objetivo: maximizar este %, si es >= 80% daremos por buena la cartera.
      </p>
    </h5>

    <canvas id="myChart" width="400" height="400"></canvas>
    <script>
          
    var data = [];
      for (var x = 1.0; x < 100.0; x += 1.0) {
        var y = 300.0 - 25.0 * x + (Math.random() - 0.5) * 100;
        data.push([x, y]); // Note that the last column should be y the output
      }

      // === Create the linear regression === //
      var regression = new jsregression.LinearRegression({
        alpha: 0.0005, //
        iterations: 3000,
        lambda: 0.0,
        trace: true,
      });
      // can also use default configuration: var regression = new jsregression.LinearRegression();

      // === Train the linear regression === //
      var model = regression.fit(data);

      // === Print the trained model === //
      console.log(model);

      // === Testing the trained linear regression === //
      var items = [];
      var items_predicted = [];
      for (var x = 1.0; x < 100.0; x += 0.5) {
        var actual_y = 300.0 - 25.0 * x + (Math.random() - 0.5) * 100;
        var predicted_y = regression.transform([x]);
        items.push({ x: x, y: actual_y });
        items_predicted.push({ x: x, y: predicted_y });
        console.log("actual: " + actual_y + " predicted: " + predicted_y);
      }
      console.log(items);
      var pointBackgroundColors = [];
      var pointBackgroundColors2 = [];
      var ctx = document.getElementById("myChart").getContext("2d");
      var myChart = new Chart(ctx, {
        type: "scatter",
        data: {
          datasets: [
            {
              label: "Actual",
              data: items,
              pointBackgroundColor: pointBackgroundColors,
              pointBorderColor: [],
            },
            {
              label: "Predicted",
              data: items_predicted,
              pointBackgroundColor: pointBackgroundColors2,
              pointBorderColor: [],
            },
          ],
        },
        options: {},
      });

      for (i = 0; i < myChart.data.datasets[0].data.length; i++) {
        pointBackgroundColors.push("#90cd8a");
        pointBackgroundColors2.push("#f58368");
      }

      myChart.update();
    </script>
  </body>
</html>
